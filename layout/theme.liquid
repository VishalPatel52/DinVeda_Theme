<!doctype html>
<html class="no-js supports-no-cookies" lang="{{ request.locale.iso_code }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="theme-color" content="{{ settings.announcement_bg }}">
    {%- if canonical_url != blank -%}
      <link rel="canonical" href="{{ canonical_url }}">
    {%- endif -%}

    <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
    {%- unless settings.main_font.system? and settings.heading_font.system? and settings.nav_font.system? -%}
      <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    {%- endunless -%}

    <!-- Preload onDomain stylesheets and script libraries -->
  <link rel="preload" href="{{ 'theme.css' | asset_url }}" as="style">
  <link rel="preload" href="{{ 'theme.js' | asset_url }}" as="script">
  <link rel="preload" href="{{ 'vendor-flickity.js' | asset_url }}" as="script">
  <link rel="preload" href="{{ 'vendor-masonry.js' | asset_url }}" as="script">

  {% if settings.favicon %}
    <link rel="shortcut icon" href="{{ settings.favicon | image_url: width: 32, height: 32 }}" type="image/png" />
  {% endif %}

  <title>
    {{ page_title }}
    {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
    {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
    {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
  </title>

  <meta name="description" content="{{ page_description | escape }}">

  {% render 'snip-social-meta-tags' %}
  {% render 'snip-structured-data' %}

  <script src="{{ 'theme.js' | asset_url }}" defer></script>

  <script src="{{ 'shopify_common.js' | shopify_asset_url }}" defer="defer"></script>

  {{ content_for_header }}

  {% render 'css-variables' %}

  {{ 'theme.css' | asset_url | stylesheet_tag }}

  {%- comment -%} Load Material Symbols font for DinVeda product pages {%- endcomment -%}
  {%- if template.name == 'product' -%}
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
  {%- endif -%}
  
  {%- comment -%} Load Italianno font for DinVeda story card signature (Brief vom Fuchs) {%- endcomment -%}
  {%- if template.name == 'product' -%}
    <link href="https://fonts.googleapis.com/css2?family=Italianno&display=swap" rel="stylesheet">
  {%- endif -%}

  {%- comment -%} Load DinVeda premium product CSS for all product templates {%- endcomment -%}
  {%- if template.name == 'product' -%}
    <link rel="preload" href="{{ 'dinveda-product-premium.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dinveda-product-premium.css' | asset_url }}"></noscript>
  {%- endif -%}
  
  {%- comment -%} Load DV template CSS for dinveda-premium template {%- endcomment -%}
  {%- if template.name == 'product' and template.suffix == 'dinveda-premium' -%}
    <link rel="preload" href="{{ 'dv-pdp.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dv-pdp.css' | asset_url }}"></noscript>
    <link rel="preload" href="{{ 'dv-product-benefits.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dv-product-benefits.css' | asset_url }}"></noscript>
    <link rel="preload" href="{{ 'dv-recipe-cards.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dv-recipe-cards.css' | asset_url }}"></noscript>
    <link rel="preload" href="{{ 'dv-purity-promise.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dv-purity-promise.css' | asset_url }}"></noscript>
  {%- endif -%}

  {%- comment -%} Load DinVeda homepage CSS only for homepage template {%- endcomment -%}
  {%- if template == 'index' -%}
    <link rel="preload" href="{{ 'dinveda-home.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dinveda-home.css' | asset_url }}"></noscript>
  {%- endif -%}

  {%- comment -%} Load Material Symbols font for DinVeda homepage {%- endcomment -%}
  {%- if template == 'index' -%}
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
  {%- endif -%}

  {%- comment -%} Load Material Symbols font for DinVeda collection pages {%- endcomment -%}
  {%- if template.name == 'collection' -%}
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
  {%- endif -%}

  {%- comment -%} Load DinVeda premium collection CSS for all collection templates {%- endcomment -%}
  {%- if template.name == 'collection' -%}
    <link rel="preload" href="{{ 'dinveda-collection-premium.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dinveda-collection-premium.css' | asset_url }}"></noscript>
  {%- endif -%}

  {%- comment -%} Load Material Symbols font for DinVeda premium cart {%- endcomment -%}
  {%- if template.name == 'cart' and (template.suffix == 'dinveda_premium' or template.suffix == 'dinveda-premium') -%}
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
  {%- endif -%}

  {%- comment -%} Load DinVeda premium cart CSS only for cart.dinveda_premium template {%- endcomment -%}
  {%- if template.name == 'cart' and (template.suffix == 'dinveda_premium' or template.suffix == 'dinveda-premium') -%}
    <link rel="preload" href="{{ 'dinveda-cart-premium.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dinveda-cart-premium.css' | asset_url }}"></noscript>
  {%- endif -%}

  {%- comment -%} Load DinVeda premium checkout CSS and JS for checkout page {%- endcomment -%}
  {%- if template.name == 'page' and page.handle == 'checkout' -%}
    <link rel="preload" href="{{ 'dinveda-checkout-premium.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dinveda-checkout-premium.css' | asset_url }}"></noscript>
    <script src="{{ 'dinveda-checkout.js' | asset_url }}" defer></script>
  {%- endif -%}

  {%- comment -%} Load Material Symbols font for DinVeda help & support page {%- endcomment -%}
  {%- if template.name == 'page' and page.handle == 'help' -%}
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
  {%- endif -%}

  {%- comment -%} Load DinVeda help & support CSS and JS for help page {%- endcomment -%}
  {%- if template.name == 'page' and page.handle == 'help' -%}
    <link rel="preload" href="{{ 'dinveda-help-support.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dinveda-help-support.css' | asset_url }}"></noscript>
    <script src="{{ 'dinveda-help-support.js' | asset_url }}" defer></script>
  {%- endif -%}

  {%- comment -%} Load Material Symbols font for DinVeda order confirmation page {%- endcomment -%}
  {%- if template.name == 'customers' and template.suffix == 'order' -%}
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
  {%- endif -%}

  {%- comment -%} Load DinVeda order confirmation CSS for customers/order template {%- endcomment -%}
  {%- if template.name == 'customers' and template.suffix == 'order' -%}
    <link rel="preload" href="{{ 'dinveda-order-confirmation.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="{{ 'dinveda-order-confirmation.css' | asset_url }}"></noscript>
  {%- endif -%}

  {%- unless settings.main_font.system? -%}
    <link rel="preload" as="font" href="{{ settings.main_font | font_url }}" type="font/woff2" crossorigin>
  {%- endunless -%}
  {%- unless settings.heading_font.system? -%}
    <link rel="preload" as="font" href="{{ settings.heading_font | font_url }}" type="font/woff2" crossorigin>
  {%- endunless -%}
  {%- unless settings.nav_font.system? -%}
    <link rel="preload" as="font" href="{{ settings.nav_font | font_url }}" type="font/woff2" crossorigin>
  {%- endunless -%}

  <script>document.documentElement.className = document.documentElement.className.replace('no-js', 'js');</script>
  {{ 'vendor-flickity.js' | asset_url | script_tag }}
</head>

{%- comment -%} DEV ONLY: ?pdp=v2 forces DinVeda v2 styles for local testing {%- endcomment -%}
{%- if template.name == 'product' -%}
  {% render 'dinveda-is-v2' %}
{%- else -%}
  {%- assign dinveda_is_v2 = false -%}
{%- endif -%}

<body id="{{ page_title | handle }}"
      class="template-{{ template.name | handle }}{% if template.suffix %} product-template-{{ template.suffix }}{% endif %}{% if template.name == 'product' and dinveda_is_v2 %} product-template-dinveda-premium-v2{% endif %} js-slideout-toggle-wrapper js-modal-toggle-wrapper {{ settings.scroll_animation }} {{ settings.text_animation }} section-fade-in buttons--{{ settings.button_animation }}">
  {% render 'snip-skip-link' %}

  {% if settings.enable_age_verify %}
    {% render 'snip-age-verification' %}
  {% endif %}

  {%- if template == 'index' -%}
    <h1 class="visually-hidden">{{ page_title }}</h1>
  {%- endif -%}

  <div class="js-slideout-overlay site-overlay"></div>
  <div class="js-modal-overlay site-overlay"></div>

  {% sections 'mobile-navigation-group' %}

    <main id="main-content" class="site-wrap" role="main" tabindex="-1">
      {% sections 'header-group' %}

      <div class="page-wrap {% unless template == 'index' %}mb10{% endunless %}">
        {{ content_for_layout }}
      </div>

      {% sections 'footer-group' %}
    </main>

    {% section 'mailing-popup' %}
    {% section 'quickshop' %}

    {%- if settings.cart_type == 'drawer' -%}
      <aside
        popover="auto"
        class="slideout slideout__drawer-right mini-cart"
        data-wau-slideout="ajax-cart"
        id="slideout-ajax-cart"
      >
        {% render 'cart-mini' %}
      </aside>
    {% elsif settings.cart_type == 'modal_cart' %}
      <div
        popover="auto"
        class="modal__container"
        data-wau-modal="ajax-cart"
        id="modal-ajax-cart"
      >
        <div class="modal__inner-wrapper">
          {% render 'cart-mini' %}
        </div>
      </div>
    {%- endif -%}

    {% render 'cart-config' %}

    <script type="text/javascript">
      var jsAssets = {
        "zoom": {{ 'vendor-zoom.js' | asset_url | json }},
        "flickity": {{ 'vendor-flickity.js' | asset_url | json }},
        "product": {{ 'product.js' | asset_url | json }},
        "productModel": {{ 'product-model.js' | asset_url | json }},
        "productVideo": {{ 'product-video.js' | asset_url | json }},
        "productPickupAvailability": {{ 'pickup-availability.js' | asset_url | json }},
        "productComplementaryProducts": {{ 'complementary-products.js' | asset_url | json }}
      }
    </script>

    <script src="{{ 'cart.js' | asset_url }}" defer="defer"></script>

    {%- if settings.product_grid_video -%}
      <script src="{{ 'vendor-video.js' | asset_url }}" defer></script>
    {%- endif -%}

    {%- render 'snip-photoswipe' -%}

    <aside
      class="slideout slideout__drawer-right"
      data-wau-slideout="store-availability"
      id="slideout-store-availability"
    ></aside>

    <wau-popover-loader data-asset-url='{{ 'vendor-popover-polyfill.js' | asset_url }}' data-css-class="popover"></wau-popover-loader>

    {%- comment -%} DEV ONLY: Preserve ?pdp=v2 query param across navigation {%- endcomment -%}
    {%- if request.query_string contains 'pdp=v2' or request.query_string contains 'PDP=V2' -%}
    <script>
      (function() {
        'use strict';
        var hasV2Param = false;
        var queryString = window.location.search;
        if (queryString) {
          var params = queryString.substring(1).split('&');
          for (var i = 0; i < params.length; i++) {
            var param = params[i].toLowerCase();
            if (param === 'pdp=v2') {
              hasV2Param = true;
              break;
            }
          }
        }
        
        if (hasV2Param) {
          // Preserve pdp=v2 on internal product and collection links
          document.addEventListener('click', function(e) {
            var target = e.target.closest('a');
            if (!target || !target.href) return;
            
            try {
              var url = new URL(target.href, window.location.origin);
              var isProductOrCollection = url.pathname.startsWith('/products/') || url.pathname.startsWith('/collections/');
              
              if (isProductOrCollection && url.hostname === window.location.hostname) {
                // Check if pdp=v2 already exists
                var hasParam = false;
                if (url.search) {
                  var existingParams = url.search.substring(1).split('&');
                  for (var j = 0; j < existingParams.length; j++) {
                    if (existingParams[j].toLowerCase() === 'pdp=v2') {
                      hasParam = true;
                      break;
                    }
                  }
                }
                
                // Add pdp=v2 if not present
                if (!hasParam) {
                  var separator = url.search ? '&' : '?';
                  url.search += separator + 'pdp=v2';
                  target.href = url.toString();
                }
              }
            } catch (err) {
              // Silently fail if URL parsing fails
            }
          });
        }
      })();
    </script>
    {%- endif -%}
  </body>
</html>
