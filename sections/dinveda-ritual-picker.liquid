{% comment %}
  DinVeda Ritual Picker - Premium ritual navigation section
  "Dein Tag in Balance" with ritual cards
  Uses Featured collection layout system
{% endcomment %}

{% comment %} Featured Collection Assets {% endcomment %}
<link rel="preload" href="{{ 'section-featured-collection.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'section-featured-collection.css' | asset_url }}"></noscript>
<link rel="preload" href="{{ 'component-product-grid.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'component-product-grid.css' | asset_url }}"></noscript>
<link rel="preload" href="{{ 'section-dinveda-ritual-picker.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'section-dinveda-ritual-picker.css' | asset_url }}"></noscript>

{% comment %} Featured Collection Layout Logic {% endcomment %}
{%- liquid
  assign background_mode = section.settings.background_mode | default: 'design_bg'
  
  assign section_padding = ''
  if section.settings.section_padding == 'top'
    assign section_padding = 'pb0'
  elsif section.settings.section_padding == 'bottom'
    assign section_padding = 'mt0'
  elsif section.settings.section_padding == 'none'
    assign section_padding = 'mt0 pb0'
  endif

  if settings.section_title_align == 'left'
    assign heading_align = 'a-left'
  elsif settings.section_title_align == 'right'
    assign heading_align = 'a-right'
  else 
    assign heading_align = 'a-center'
  endif

  assign items_per_row = section.settings.items_per_row | default: 4

  case items_per_row
  when 5
    assign wrapper_class = 'wrapper-fifths'
    assign grid_width = 'span-3 auto'
  when 4
    assign grid_width = 'span-3 auto'
  when 3
    assign grid_width = 'span-4 auto'
  when 2
    assign grid_width = 'span-6 auto'
  when 1
    assign grid_width = 'span-12'
  endcase

  case section.settings.mobile_items_per_row
    when '1'
      assign mobile_per_row = 'sm-span-12'
    when '2'
      assign mobile_per_row = 'sm-span-6'
    else
      assign mobile_per_row = 'sm-span-6'
  endcase

  assign carousel = false
  if section.settings.display_type == 'carousel'
    assign carousel = true
  endif

  assign blocks_count = section.blocks.size
  assign enough_to_wrap = true
  if blocks_count <= items_per_row
    assign enough_to_wrap = false
  endif

  case items_per_row
  when 2
    assign prod_grid = 51
    assign noJSGrid = 48.95
  when 3
    assign prod_grid = 34
    assign noJSGrid = 31.95
  when 4
    assign prod_grid = 25.5
    assign noJSGrid = 23.45
  when 5
    assign prod_grid = 20.4
    assign noJSGrid = 18.35
  else
    assign prod_grid = 25.5
    assign noJSGrid = 23.45
  endcase

  if carousel
    assign heading_width = 'span-12 auto sm-span-8'
  else
    assign heading_width = 'span-12 auto sm-span-12'
  endif

  assign has_padding = settings.product_grid_padding
  assign has_dropshadow = settings.product_grid_dropshadow

  if has_padding
    assign item_padding = 'sm-px0 sm-py0 px6 py6'
  else
    assign item_padding = 'sm-px0 sm-py0 px0 py0'
  endif
-%}

{% capture carousel_config %}{
  "wrapAround":{{ enough_to_wrap }},
  "cellAlign": "left",
  "dragThreshold":"15",
  "draggable": {{ enough_to_wrap }},
  "pauseAutoPlayOnHover":false,
  "prevNextButtons":{{ enough_to_wrap }},
  "pageDots": false,
  "accessibility": false,
  "arrowShape": "M 10,50 L 60,100 L 70,90 L 30,50  L 70,10 L 60,0 Z"
}{% endcapture %}

<div
  class="section-featured-collection dinveda-ritual-picker dinveda-ritual-picker-{{ section.id }} global__section {{ section_padding }}"
  id="dein-tag-in-balance"
  data-section-id="{{ section.id }}"
  data-section-type="{% if carousel %}carousel{% else %}dinveda-ritual-picker{% endif %}"
  {% if carousel %}data-section-loaded="false" data-asset-url="{{ 'carousel.js' | asset_url }}"{% endif %}
>
  {%- comment -%} Debug Marker {%- endcomment -%}
  {% if section.settings.debug_mode %}
    <div style="background: red; color: white; padding: 10px; margin-bottom: 20px; text-align: center; font-weight: bold;">
      DEBUG: DinVeda Ritual Picker Section Active (ID: {{ section.id }})
    </div>
  {% endif %}

  <div class="grid__wrapper relative section-featured-collection__wrapper--{%- if carousel -%}carousel{%- else -%}grid{%- endif -%}">
    {%- comment -%} Section Header using snip-headings {%- endcomment -%}
    {% render 'snip-headings', grid: heading_width, classes: 'section-featured-collection__section-heading dinveda-ritual-picker__section-heading', align: heading_align %}
    
    {%- comment -%} Subtitle (custom, not in snip-headings) {%- endcomment -%}
    {% if section.settings.subtitle != blank %}
      <div class="{{ heading_width }} dinveda-ritual-picker__subtitle-wrapper">
        <p class="dinveda-ritual-picker__subtitle {{ heading_align }}">{{ section.settings.subtitle | escape }}</p>
      </div>
    {% endif %}
    
    {%- comment -%} View All Button {%- endcomment -%}
    {% if section.settings.show_view_all and section.settings.view_all_url != blank %}
      <a href="{{ section.settings.view_all_url }}" class="button view--all_button{% if heading_align == 'a-left'%} align--right{% endif %}">{{ 'products.general.view_all' | t }}</a>
    {% endif %}

    {%- comment -%} Ritual Cards Grid/Carousel {%- endcomment -%}
    {% if section.blocks.size > 0 %}
      <div class="featured-collection__wrapper--loop dinveda-ritual-picker__wrapper--loop span-12{% if carousel %} js-carousel{% endif %}" {%- if carousel -%}data-flickity='{{ carousel_config }}'{%- endif -%}>
        {%- unless carousel -%}<div class="grid__wrapper edge cg6 rg6 {{ wrapper_class }}">{%- endunless -%}
        {% for block in section.blocks %}
          {% if block.type == 'ritual_card' %}
            {%- liquid
              assign card_image = block.settings.image
              assign card_link = block.settings.link
              
              # Image alt fallback
              if block.settings.image != blank
                assign image_alt = block.settings.image.alt | default: block.settings.blend_name | default: block.settings.phase_label
              else
                assign image_alt = block.settings.blend_name | default: block.settings.phase_label
              endif
              
              assign button_label = block.settings.button_label | default: 'Zu diesem Ritual'
              
              # Detect if link is a product and get product data
              assign product_handle = ''
              assign linked_product = null
              assign is_product_link = false
              if card_link != blank
                if card_link contains '/products/'
                  assign link_parts = card_link | split: '/products/'
                  if link_parts.size > 1
                    assign product_handle = link_parts[1] | split: '?' | first | split: '#' | first
                    assign linked_product = all_products[product_handle]
                    if linked_product != blank
                      assign is_product_link = true
                    endif
                  endif
                endif
              endif
              
              # Get product variant info if it's a product link
              assign current_variant = null
              assign is_single_variant = false
              assign product_available = false
              if is_product_link and linked_product != blank
                assign current_variant = linked_product.selected_or_first_available_variant
                if linked_product.variants.size == 1
                  assign is_single_variant = true
                endif
                if current_variant != blank
                  assign product_available = current_variant.available
                endif
              endif
            -%}
            
            <article 
              class="dinveda-ritual-picker__card product-loop__item dropshadow--{{ has_dropshadow }} padding--{{ has_padding }} {{ mobile_per_row }} {% unless carousel %}{{ grid_width }}{% endunless %} relative{% if card_link != blank %} dinveda-ritual-picker__card--has-link{% endif %}" 
              {{ block.shopify_attributes }}
              {% if is_product_link %}data-product-handle="{{ product_handle }}" data-product-id="{{ linked_product.id }}" data-single-variant="{{ is_single_variant }}" data-variant-id="{{ current_variant.id }}"{% endif %}
            >
              {%- liquid
                assign has_quick_add = false
                if section.settings.enable_quick_add and is_product_link and linked_product != blank and linked_product.id != blank and current_variant != blank and current_variant.id != blank and product_available
                  assign has_quick_add = true
                endif
              -%}
              
              {% if card_link != blank %}
                {%- liquid
                  assign link_aria_label = block.settings.blend_name | default: block.settings.phase_label | default: 'Ritual card'
                -%}
                <a href="{{ card_link }}" class="dinveda-ritual-picker__card-link" aria-label="{{ link_aria_label | escape }}">
              {% endif %}
              
              <div class="dinveda-ritual-picker__card-inner">
                
                {%- comment -%} Image {%- endcomment -%}
                {% if card_image != blank %}
                  {%- liquid
                    assign image_alt_escaped = image_alt | escape
                  -%}
                  <div class="dinveda-ritual-picker__image-wrapper">
                    {{ card_image | image_url: width: 600 | image_tag: alt: image_alt_escaped, loading: 'lazy', class: 'dinveda-ritual-picker__image' }}
                  </div>
                {% else %}
                  <div class="dinveda-ritual-picker__image-wrapper dinveda-ritual-picker__image-wrapper--placeholder">
                    {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
                  </div>
                {% endif %}

                {%- comment -%} Content {%- endcomment -%}
                <div class="dinveda-ritual-picker__content">
                  
                  {% if block.settings.phase_label != blank %}
                    <p class="dinveda-ritual-picker__phase-label">{{ block.settings.phase_label | escape }}</p>
                  {% endif %}

                  {% if block.settings.blend_name != blank %}
                    <h3 class="dinveda-ritual-picker__blend-name">{{ block.settings.blend_name | escape }}</h3>
                  {% endif %}

                  {% if block.settings.quote_line != blank or block.settings.descriptor != blank or block.settings.attribution_line != blank %}
                    <div class="dinveda-ritual-picker__quote-block">
                      {% if block.settings.quote_line != blank %}
                        <p class="dinveda-ritual-picker__quote-line">{{ block.settings.quote_line | escape }}</p>
                      {% endif %}
                      {% if block.settings.descriptor != blank %}
                        <p class="dinveda-ritual-picker__descriptor">{{ block.settings.descriptor | escape }}</p>
                      {% endif %}
                      {% if block.settings.attribution_line != blank %}
                        <div class="dinveda-ritual-picker__attribution-wrapper">
                          <div class="dinveda-ritual-picker__attribution-line">
                            {% if block.settings.animal_image != blank %}
                              <img src="{{ block.settings.animal_image | image_url: width: 40 }}" alt="{{ block.settings.attribution_line | escape }}" class="dinveda-ritual-picker__animal-image">
                            {% endif %}
                            <p class="dinveda-ritual-picker__animal-name">{{ block.settings.attribution_line | escape }}</p>
                          </div>
                        </div>
                      {% endif %}
                    </div>
                  {% endif %}

                </div>

              </div>

              {% if card_link != blank %}
                </a>
              {% endif %}
              
              {%- comment -%} Plus Button (Quick Add to Cart) {%- endcomment -%}
              {% if has_quick_add and linked_product != blank and linked_product.id != blank and current_variant != blank and current_variant.id != blank and product_available %}
                <button 
                  class="quick-view-{{ linked_product.id }} product-listing__quickview-trigger dinveda-ritual-picker__quick-add-btn no-js-hidden"
                  type="button"
                  name="button"
                  aria-label="Add to cart"
                  data-variant-id="{{ current_variant.id }}"
                  data-product-id="{{ linked_product.id }}"
                  data-product-handle="{{ product_handle }}"
                  {% unless product_available %}disabled{% endunless %}
                >
                  {% render 'snip-icons',
                    wrapper: '.product-listing__quickview-trigger--modal',
                    type: 'theme',
                    icon: 'plus',
                    classes: 'quickview-trigger--plus vib-center',
                    size: '18px',
                    fill: 'var(--directional-text)',
                    hover: 'var(--directional-text)' %}
                  {% render 'snip-icons',
                    wrapper: '.product-listing__quickview-trigger--modal',
                    type: 'theme',
                    icon: 'checkmark',
                    classes: 'quickview-trigger--check vib-center',
                    size: '18px',
                    fill: 'var(--directional-text)',
                    hover: 'var(--directional-text)' %}
                  {% render 'snip-icons',
                    wrapper: '.product-listing__quickview-trigger--modal',
                    type: 'apollo',
                    icon: 'spinner',
                    classes: 'quickview-trigger--loading vib-center',
                    size: '18px',
                    fill: 'var(--directional-text)',
                    hover: 'var(--directional-text)' %}
                </button>
              {% endif %}
              
              {%- comment -%} Animal Overlay (positioned outside card-inner, relative to card) {%- endcomment -%}
              {% if block.settings.overlay_image != blank %}
                <div class="dinveda-ritual-picker__overlay dinveda-ritual-picker__overlay--{{ block.settings.overlay_anchor }}"
                     style="--ov-size: {{ block.settings.overlay_size }}px; --ov-x: {{ block.settings.overlay_offset_x }}px; --ov-y: {{ block.settings.overlay_offset_y }}px;">
                  {{ block.settings.overlay_image | image_url: width: 400 | image_tag: alt: block.settings.attribution_line | default: block.settings.blend_name, class: 'dinveda-ritual-picker__overlay-img', loading: 'lazy' }}
                </div>
              {% endif %}
            </article>

          {% endif %}
        {% endfor %}
        {%- unless carousel -%}</div>{%- endunless -%}
      </div>
    {% endif %}
  </div>
</div>

{% style %}
  .dinveda-ritual-picker-{{ section.id }} {
    {% case background_mode %}
      {% when 'design_bg' %}
        background-color: var(--design-bg-color);
      {% when 'design_secondary_bg' %}
        background-color: var(--design-secondary-bg);
      {% when 'transparent' %}
        background-color: transparent;
    {% endcase %}
  }
  
  .dinveda-ritual-picker__subtitle-wrapper {
    margin-bottom: 24px;
  }
  
  .dinveda-ritual-picker__subtitle {
    font-family: var(--main-family);
    font-size: var(--design-body-font-size);
    font-weight: var(--main-weight);
    line-height: 1.6;
    color: var(--design-text-color);
    margin: 0;
    opacity: 0.85;
  }
  
  
  .dinveda-ritual-picker__attribution-wrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: var(--dv-space-descriptor-to-attrib);
  }
  
  .dinveda-ritual-picker__attribution-line {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 1;
    min-height: 40px;
    width: 100%;
  }
  
  .dinveda-ritual-picker__animal-image {
    width: 40px;
    height: 40px;
    object-fit: contain;
    flex-shrink: 0;
    border-radius: 50%;
  }
  
  /* Plus Button - Match Featured Collection Styling */
  .dinveda-ritual-picker__quick-add-btn {
    display: block !important;
    position: absolute;
    bottom: 10px;
    right: 10px;
    text-align: center;
    background: var(--directional-bg, #3D2C20);
    color: var(--directional-text, #ffffff);
    width: 44px;
    height: 44px;
    line-height: 42px;
    padding: 0;
    margin-bottom: 0;
    border: none;
    border-radius: 0;
    -webkit-transition: background .5s ease, color .5s ease;
    -moz-transition: background .5s ease, color .5s ease;
    -o-transition: background .5s ease, color .5s ease;
    transition: background .5s ease, color .5s ease;
    -webkit-appearance: none;
    z-index: 15;
    cursor: pointer;
    pointer-events: auto;
  }
  
  .dinveda-ritual-picker__quick-add-btn:hover:not(:disabled) {
    background: var(--directional-hover, #5D4037) !important;
  }
  
  .dinveda-ritual-picker__quick-add-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .dinveda-ritual-picker__quick-add-btn svg.quickview-trigger--check {
    display: none;
  }
  
  .dinveda-ritual-picker__quick-add-btn svg.quickview-trigger--loading {
    display: none;
    -webkit-animation: rotate 2s linear infinite;
    animation: rotate 2s linear infinite;
  }
  
  .dinveda-ritual-picker__quick-add-btn.loading-quickshop svg.quickview-trigger--plus {
    display: none;
  }
  
  .dinveda-ritual-picker__quick-add-btn.loading-quickshop svg.quickview-trigger--loading {
    display: inline-block;
  }
  
  .dinveda-ritual-picker__quick-add-btn.js-quick-adding svg.quickview-trigger--plus {
    display: none;
  }
  
  .dinveda-ritual-picker__quick-add-btn.js-quick-adding svg.quickview-trigger--check {
    display: inline-block;
  }
  
  @media (max-width: 767px) {
    .dinveda-ritual-picker__animal-image {
      width: 32px;
      height: 32px;
    }
    
    .dinveda-ritual-picker__attribution-line {
      min-height: 32px;
    }
    
    .dinveda-ritual-picker__quick-add-btn {
      width: 40px;
      height: 40px;
      line-height: 38px;
      bottom: 10px;
      right: 10px;
    }
    
    .dinveda-ritual-picker__quick-add-btn svg {
      width: 16px;
      height: 16px;
    }
  }
  
  {%- comment -%} Carousel Styling {%- endcomment -%}
  {% if carousel %}
    @media (min-width: 768px) {
      .section--reloaded .dinveda-ritual-picker-{{ section.id }}[data-section-loaded="false"] .dinveda-ritual-picker__card,
      .dinveda-ritual-picker-{{ section.id }}[data-section-loaded="false"] .dinveda-ritual-picker__card,
      .no-js .dinveda-ritual-picker-{{ section.id }} .section-featured-collection__wrapper--carousel .dinveda-ritual-picker__card {
        width: {{ noJSGrid }}% !important;
        margin-right: 2%;
        display: inline-block !important;
      }
      .section--reloaded .dinveda-ritual-picker-{{ section.id }}[data-section-loaded="false"] .dinveda-ritual-picker__card:nth-child({{ items_per_row }}),
      .dinveda-ritual-picker-{{ section.id }}[data-section-loaded="false"] .dinveda-ritual-picker__card:nth-child({{ items_per_row }}),
      .no-js .dinveda-ritual-picker-{{ section.id }} .section-featured-collection__wrapper--carousel .dinveda-ritual-picker__card:nth-child({{ items_per_row }}) {
        margin-right: 0;
      }
      .dinveda-ritual-picker-{{ section.id }} .section-featured-collection__wrapper--carousel .flickity-slider .dinveda-ritual-picker__card {
        width: calc(({{ prod_grid }}% - 2%) - (2% / {{ items_per_row }})) !important;
        padding-right: 0;
        margin-right: 2%;
        display: block !important;
      }
    }
  {% endif %}
{% endstyle %}

<script>
(function() {
  'use strict';
  
  function initQuickAdd() {
    var section = document.querySelector('.dinveda-ritual-picker-{{ section.id }}');
    if (!section) {
      console.log('Ritual picker section not found');
      return;
    }
    
    var quickAddButtons = section.querySelectorAll('.dinveda-ritual-picker__quick-add-btn');
    console.log('Found quick add buttons:', quickAddButtons.length);
    
    if (quickAddButtons.length === 0) return;
    
    var cartConfig = document.getElementById('cart-config');
    if (cartConfig) {
      cartConfig = JSON.parse(cartConfig.innerHTML || '{}');
    }
    
    // Handle quick add buttons
    quickAddButtons.forEach(function(button) {
      var variantId = button.dataset.variantId;
      
      console.log('Setting up button with variant ID:', variantId);
      
      if (!variantId) {
        console.log('No variant ID found for button');
        return;
      }
      
      // Handle button click
      button.addEventListener('click', function(e) {
        console.log('Button clicked!');
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        
        if (button.disabled) {
          console.log('Button is disabled');
          return;
        }
        
        console.log('Adding variant to cart:', variantId);
        
        // Add loading state
        button.classList.add('loading-quickshop');
        
        // Add to cart using Shopify API
        fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: variantId,
            quantity: 1
          })
        })
        .then(function(response) {
          if (!response.ok) {
            return response.json().then(function(err) { throw err; });
          }
          return response.json();
        })
        .then(function(data) {
          console.log('Product added to cart:', data);
          
          // Remove loading state
          button.classList.remove('loading-quickshop');
          button.classList.add('js-quick-adding');
          
          // Trigger cart update event
          document.dispatchEvent(new CustomEvent('cart:updated'));
          
          // Update cart view and show drawer
          if (typeof WAU !== 'undefined' && WAU.ThemeCart && WAU.ThemeCart.getCart) {
            WAU.ThemeCart.getCart().then(function(cart) {
              if (typeof WAU !== 'undefined' && WAU.AjaxCart) {
                if (WAU.AjaxCart.updateView) {
                  WAU.AjaxCart.updateView(cartConfig, cart);
                }
                
                // Show cart drawer if configured
                if (cartConfig && cartConfig.cart_action === 'drawer' && cartConfig.cart_added_event === 'go_to_active_cart' && WAU.AjaxCart.showDrawer) {
                  WAU.AjaxCart.showDrawer(cartConfig);
                } else if (cartConfig && cartConfig.cart_action === 'drawer' && WAU.AjaxCart.showDrawer) {
                  // Also show drawer if cart_action is drawer (fallback)
                  WAU.AjaxCart.showDrawer(cartConfig);
                }
              }
            });
          }
          
          // Reset button state after a delay
          setTimeout(function() {
            button.classList.remove('js-quick-adding');
          }, 2000);
        })
        .catch(function(error) {
          console.error('Error adding to cart:', error);
          button.classList.remove('loading-quickshop');
          button.classList.remove('js-quick-adding');
          alert('Error adding product to cart: ' + (error.message || 'Please try again.'));
        });
      });
    });
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initQuickAdd);
  } else {
    // DOM already ready
    initQuickAdd();
  }
})();
</script>

{% schema %}
{
  "name": "DinVeda Ritual Picker",
  "tag": "section",
  "class": "dynamic-section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Dein Tag in Balance"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Ayurvedische Rituale für jeden Moment deines Tages"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "display_type",
      "label": "Display type",
      "options": [
        {
          "value": "carousel",
          "label": "Carousel"
        },
        {
          "value": "grid",
          "label": "Grid"
        }
      ],
      "default": "grid"
    },
    {
      "type": "range",
      "id": "items_per_row",
      "min": 2,
      "max": 5,
      "step": 1,
      "label": "Items per row",
      "default": 4
    },
    {
      "type": "radio",
      "id": "mobile_items_per_row",
      "label": "Items per row mobile",
      "default": "2",
      "info": "When grid display type selected",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ]
    },
    {
      "type": "select",
      "id": "section_padding",
      "label": "Section spacing",
      "options": [
        {
          "value": "top",
          "label": "Top"
        },
        {
          "value": "bottom",
          "label": "Bottom"
        },
        {
          "value": "both",
          "label": "Both"
        },
        {
          "value": "none",
          "label": "None"
        }
      ],
      "default": "both"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show view all button",
      "default": false
    },
    {
      "type": "url",
      "id": "view_all_url",
      "label": "View all link",
      "info": "URL for the view all button"
    },
    {
      "type": "select",
      "id": "background_mode",
      "label": "Background color",
      "options": [
        {
          "value": "design_bg",
          "label": "Design System Background"
        },
        {
          "value": "design_secondary_bg",
          "label": "Design System Secondary Background"
        },
        {
          "value": "transparent",
          "label": "Transparent"
        }
      ],
      "default": "design_bg"
    },
    {
      "type": "header",
      "content": "Quick Add to Cart"
    },
    {
      "type": "checkbox",
      "id": "enable_quick_add",
      "label": "Enable quick add to cart",
      "default": true,
      "info": "Show 'Add to Cart' button on ritual cards that link to products"
    },
    {
      "type": "text",
      "id": "quick_add_button_label",
      "label": "Quick add button label",
      "default": "In den Warenkorb",
      "info": "Label for the quick add to cart button"
    },
    {
      "type": "checkbox",
      "id": "show_price_on_button",
      "label": "Show price on quick add button",
      "default": false,
      "info": "Display product price on the add to cart button"
    },
    {
      "type": "select",
      "id": "quick_add_button_style",
      "label": "Quick add button style",
      "options": [
        {
          "value": "primary",
          "label": "Primary"
        },
        {
          "value": "secondary",
          "label": "Secondary"
        }
      ],
      "default": "primary"
    },
    {
      "type": "select",
      "id": "multi_variant_behavior",
      "label": "Multi-variant product behavior",
      "options": [
        {
          "value": "redirect",
          "label": "Redirect to product page"
        },
        {
          "value": "quickshop",
          "label": "Show quick shop (if available)"
        }
      ],
      "default": "redirect",
      "info": "What happens when clicking add to cart on products with multiple variants"
    },
    {
      "type": "header",
      "content": "Debug"
    },
    {
      "type": "checkbox",
      "id": "debug_mode",
      "label": "Enable debug mode",
      "default": false,
      "info": "Show debug marker to verify section is loading"
    }
  ],
  "blocks": [
    {
      "type": "ritual_card",
      "name": "Ritual Card",
      "limit": 4,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "phase_label",
          "label": "Phase label",
          "default": "MORGEN | AKTIVIEREN"
        },
        {
          "type": "text",
          "id": "blend_name",
          "label": "Blend name",
          "default": "Golden Boost"
        },
        {
          "type": "text",
          "id": "quote_line",
          "label": "Quote line (italic)",
          "default": "Ich starte clever und klar in den Tag."
        },
        {
          "type": "textarea",
          "id": "descriptor",
          "label": "Descriptor (bold)",
          "default": "Für Energie, Fokus & innere Wärme"
        },
        {
          "type": "text",
          "id": "attribution_line",
          "label": "Attribution line",
          "default": "— sagt der Fuchs"
        },
        {
          "type": "image_picker",
          "id": "animal_image",
          "label": "Animal image",
          "info": "Image of the animal mentioned in the attribution line"
        },
        {
          "type": "header",
          "content": "Animal Overlay"
        },
        {
          "type": "image_picker",
          "id": "overlay_image",
          "label": "Overlay animal image",
          "info": "Animal sticker/mascot PNG (transparent background recommended)"
        },
        {
          "type": "range",
          "id": "overlay_size",
          "label": "Overlay size",
          "min": 40,
          "max": 180,
          "step": 2,
          "unit": "px",
          "default": 96,
          "info": "Size of the animal overlay image"
        },
        {
          "type": "range",
          "id": "overlay_offset_x",
          "label": "Horizontal offset",
          "min": -120,
          "max": 120,
          "step": 3,
          "unit": "px",
          "default": -9,
          "info": "Move overlay left (negative) or right (positive)"
        },
        {
          "type": "range",
          "id": "overlay_offset_y",
          "label": "Vertical offset",
          "min": -160,
          "max": 120,
          "step": 4,
          "unit": "px",
          "default": -56,
          "info": "Move overlay up (negative = above card) or down (positive)"
        },
        {
          "type": "select",
          "id": "overlay_anchor",
          "label": "Overlay anchor",
          "options": [
            {
              "value": "top_left",
              "label": "Top Left"
            },
            {
              "value": "top_center",
              "label": "Top Center"
            },
            {
              "value": "top_right",
              "label": "Top Right"
            }
          ],
          "default": "top_left",
          "info": "Anchor point for overlay positioning"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label",
          "default": "Zu diesem Ritual"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "DinVeda Ritual Picker",
      "blocks": [
        {
          "type": "ritual_card",
          "settings": {
            "phase_label": "MORGEN | AKTIVIEREN",
            "blend_name": "Golden Boost",
            "quote_line": "Ich starte clever und klar in den Tag.",
            "descriptor": "Für Energie, Fokus & innere Wärme",
            "attribution_line": "— sagt der Fuchs",
            "button_label": "Zu diesem Ritual"
          }
        },
        {
          "type": "ritual_card",
          "settings": {
            "phase_label": "TAG | ZENTRIEREN",
            "blend_name": "Flow & Glow",
            "quote_line": "Ich genieße Balance und Ruhe.",
            "descriptor": "Für Leichtigkeit, Balance & innere Strahlkraft",
            "attribution_line": "— sagt der Panda",
            "button_label": "Zu diesem Ritual"
          }
        },
        {
          "type": "ritual_card",
          "settings": {
            "phase_label": "BALANCE | AUSGLEICHEN",
            "blend_name": "Ova Harmony",
            "quote_line": "Ich blühe in Leichtigkeit & Harmonie.",
            "descriptor": "Für Ausgleich, Harmonie & sanfte Energie",
            "attribution_line": "— sagt der Schmetterling",
            "button_label": "Zu diesem Ritual"
          }
        },
        {
          "type": "ritual_card",
          "settings": {
            "phase_label": "ABEND | LOSLASSEN",
            "blend_name": "Moon Rest",
            "quote_line": "Ich finde Ruhe am Abend und lasse los.",
            "descriptor": "Für Entspannung, Ruhe & erholsamen Schlaf",
            "attribution_line": "— sagt der Koala",
            "button_label": "Zu diesem Ritual"
          }
        }
      ]
    }
  ]
}
{% endschema %}
