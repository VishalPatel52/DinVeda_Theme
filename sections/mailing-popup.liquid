{% comment %} Mailing Popup Assets {% endcomment %}
<link rel="preload" href="{{ 'section-mailing-popup.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{ 'section-mailing-popup.css' | asset_url }}"></noscript>

<div class="section-mailing-popup no-section-animation"
  data-section-id="{{ section.id }}"
  data-asset-url="{{ 'section-mailing-popup.js' | asset_url }}"
  data-section-type="mailing-popup">
  <div class="js-popup-overlay newsletter__popup-overlay"></div>
  <div class="js-popup newsletter__popup-container"
       style="display:none"
       data-popup-enabled={{ section.settings.popup | json }}
       data-popup-delay={{ section.settings.popup_delay | json }}
       data-popup-frequency={{ section.settings.popup_frequency | json }}>

      <button class="js-popup-close newsletter__popup-container-close btn-as-link" aria-hidden="true" style="padding: var(--space-2) !important;" tabindex="0" type="button" name="button">
        {% render 'snip-icons',
           wrapper: '.newsletter__popup-container-close',
           type: 'theme',
           icon: 'close',
           size: '15px',
           fill: section.settings.popup_text_color,
           hover: section.settings.popup_text_color %}
      </button>
    <div id="newsletter__popup-content" class="newsletter__popup-contentid">
      <!-- Fox illustration at the top -->
      <div class="newsletter__popup-illustration">
        {% if section.settings.fox_illustration != blank %}
          <img src="{{ section.settings.fox_illustration | image_url: width: 120 }}" alt="Fox illustration" width="120" height="80">
        {% else %}
          {{ 'fox-illustration.svg' | asset_url | img_tag: 'Fox illustration', 'width: 120, height: 80' }}
        {% endif %}
      </div>
      
      <!-- Single column content wrapper -->
      <div class="newsletter__popup-contentWrapper">
        <div class="newsletter__popup-text">
          {% if section.settings.popup_type == 'product-notification' %}
            <h3>{{ 'product_notification.popup_title' | t }}</h3>
            <p>{{ 'product_notification.popup_text' | t }}</p>
          {% else %}
            {% if section.settings.mail_popup_title %}
              <h3>{{ section.settings.mail_popup_title }}</h3>
            {% endif %}
            {% if section.settings.mail_popup_text %}
              <p>{{ section.settings.mail_popup_text }}</p>
            {% endif %}
          {% endif %}
        </div>
        
        <div class="newsletter__popup-form">
          {% form 'customer', id: 'mailing-popup-form' %}
            <div class="form form-vertical v-center">
              {% if section.settings.popup_type == 'product-notification' %}
                <input type="hidden" name="contact[tags]" value="product-notification, golden-boost">
              {% else %}
                <input type="hidden" name="contact[tags]" value="prospect, newsletter">
              {% endif %}
              
              <label class="visually-hidden" for="newsletter__popup-form__email">
                {% if section.settings.popup_type == 'product-notification' %}
                  {{ 'product_notification.email_placeholder' | t }}
                {% else %}
                  {{ 'general.newsletter_form.email_placeholder' | t }}
                {% endif %}
              </label>
              
              <input type="email" 
                     id="newsletter__popup-form__email" 
                     name="contact[email]" 
                     placeholder="{% if section.settings.popup_type == 'product-notification' %}{{ 'product_notification.email_placeholder' | t }}{% else %}{{ 'general.newsletter_form.email_placeholder' | t }}{% endif %}">
              
              {% if section.settings.popup_type == 'product-notification' and section.settings.show_gdpr_checkbox %}
                <div class="gdpr-checkbox-wrapper">
                  <input type="checkbox" id="gdpr-consent" name="gdpr_consent" required>
                  <label for="gdpr-consent" class="gdpr-checkbox-label">
                    {{ 'product_notification.gdpr_text' | t }} 
                    <a href="{{ section.settings.privacy_policy_url | default: '/policies/privacy-policy' }}" target="_blank">{{ 'product_notification.gdpr_link' | t }}</a>
                  </label>
                </div>
              {% endif %}
              
              <button type="submit" class="newsletter__popup-submit-btn">
                {% if section.settings.popup_type == 'product-notification' %}
                  {{ 'product_notification.submit' | t }}
                {% else %}
                  {{ section.settings.mail_button_text | default: 'general.newsletter_form.submit' | t }}
                {% endif %}
              </button>
              
              {% if section.settings.popup_type != 'product-notification' and section.settings.mail_gdpr_text %}
                <div class="gdpr-text before-signup">{{ section.settings.mail_gdpr_text }}</div>
              {% endif %}
            </div>
          {% endform %}
        </div>
      </div>
    </div>
  </div>
  <style>
    #newsletter__popup-content {
      background-color: {{ section.settings.popup_background_color }};
      {% if section.settings.popup_image == 'content' %}
        padding: 0;
      {% endif %}
      {% if section.settings.popup_image == 'background' %}
        height: 600px;
      {% endif %}
    }
    .newsletter__popup-text h3,
    .newsletter__popup-text p,
    .gdpr-text.before-signup p,
    .newsletter__popup-form input[type="email"],
    .newsletter__popup-form input[type="email"]::placeholder,
    .gdpr-text.before-signup a  {
        color: {{ section.settings.popup_text_color }};
    }
    .newsletter__popup-text h3 {
      font-size: {{ section.settings.popup_h3_size }}px;
    }
    .newsletter__popup-text p {
      font-size: {{ section.settings.popup_subheading_size }}px;
    }
    .newsletter__popup-text .newsletter__popup-form input[type="email"] {
      border-color: {{ section.settings.popup_text_color }};
      background: {{ section.settings.popup_background_color }};
      font-size: var(--font-size);
    }
    p.gdpr-text {
      color: {{ section.settings.popup_text_color }};
    }
    {% if section.settings.popup_image == 'background' %}
      .newsletter__popup-contentWrapper {
        width: 100%;
        position: absolute;
        top: 50%;
        left: 50%;
        -webkit-transform: translate(-50%, -50%);
        -ms-transform: translate(-50%, -50%);
        -moz-transform: translate(-50%, -50%);
        -o-transform: translate(-50%, -50%);
      }
    {% endif %}

    {% if section.settings.email_image != blank and section.settings.popup_image == 'background' %}
    #newsletter__popup-content {
      background: url({{ section.settings.email_image | image_url: width: 1200 }});
      background-size: cover;
      background-repeat: no-repeat;
      background-position: {{ section.settings.email_image.presentation.focal_point | default: 'inherit' }};
    }
    {% else %}
    #newsletter__popup-content .newsletter__popup-image {
      background: url({{ section.settings.email_image | image_url: width: 1200 }});
      background-size: cover;
      background-repeat: no-repeat;
      background-position: {{ section.settings.email_image.presentation.focal_point | default: 'inherit' }};
      width: 100%;
      min-height: 600px;
    }
    {% endif %}
  </style>
</div>
<script src="{{ 'section-mailing-popup.js' | asset_url }}" defer></script>
{% schema %}
{
  "name": "Mailing popup",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "Popup Configuration"
    },
    {
      "type": "checkbox",
      "id": "popup",
      "label": "Show popup",
      "default": false
    },
    {
      "type": "select",
      "id": "popup_type",
      "options": [
        { "value": "newsletter", "label": "Newsletter signup"},
        { "value": "product-notification", "label": "Product availability notification"}
      ],
      "label": "Popup type",
      "default": "product-notification"
    },
    {
      "type": "range",
      "id": "popup_delay",
      "min": 0,
      "max": 300,
      "step": 5,
      "unit": "sec",
      "label": "Popup delay in seconds",
      "default": 5
    },
    {
      "type": "range",
      "id": "popup_frequency",
      "min": 1,
      "max": 30,
      "step": 1,
      "unit": "day",
      "label": "Popup frequency",
      "default": 7
    },
    {
      "type": "header",
      "content": "Illustration"
    },
    {
      "type": "image_picker",
      "id": "fox_illustration",
      "label": "Fox illustration",
      "info": "Upload custom fox illustration (120x80px recommended). If empty, default SVG will be used."
    },
    {
      "type": "header",
      "content": "Content (Newsletter Mode)"
    },
    {
      "type": "text",
      "id": "mail_popup_title",
      "label": "Heading",
      "default": "Keep In Touch"
    },
    {
      "type": "text",
      "id": "mail_popup_text",
      "label": "Subheading",
      "default": "Signup for exclusive offers and promotions."
    },
    {
      "type": "text",
      "id": "mail_button_text",
      "label": "Button text",
      "default": "Signup"
    },
    {
      "type": "richtext",
      "id": "mail_gdpr_text",
      "label": "GDPR text",
      "default": "<p>*By completing this form you're signing up to receive our emails and can unsubscribe at any time.</p>"
    },
    {
      "type": "header",
      "content": "Product Notification Settings"
    },
    {
      "type": "checkbox",
      "id": "show_gdpr_checkbox",
      "label": "Show GDPR consent checkbox",
      "default": true,
      "info": "Required for product notification popup type"
    },
    {
      "type": "url",
      "id": "privacy_policy_url",
      "label": "Privacy policy URL",
      "info": "Link for GDPR consent checkbox. Defaults to /policies/privacy-policy if not set."
    },
    {
      "type": "header",
      "content": "Legacy Image Settings"
    },
    {
      "type": "paragraph",
      "content": "These settings are for backward compatibility with old popup design."
    },
    {
     "type": "select",
     "id": "popup_image",
     "options": [
      { "value": "background", "label": "Background image"},
      { "value": "content", "label": "Content image"}
    ],
     "label": "Image type (Legacy)"
   },
   {
    "type": "image_picker",
    "id": "email_image",
    "label": "Background/Content Image (Legacy)",
    "info": "Only used with old popup design. Background image: 600px x 650px / Content image: 600px x 400px recommended."
  },
  {
    "type": "header",
    "content": "Legacy Style Settings"
  },
  {
    "type": "range",
    "id": "popup_h3_size",
    "min": 16,
    "max": 48,
    "step": 1,
    "unit": "px",
    "label": "Heading size (Legacy)",
    "default": 28
  },
  {
    "type": "range",
    "id": "popup_subheading_size",
    "min": 12,
    "max": 20,
    "step": 1,
    "unit": "px",
    "label": "Subheading size (Legacy)",
    "default": 16
  },
  {
    "type": "color",
    "id": "popup_text_color",
    "label": "Text color (Legacy)",
    "default": "#C17129",
    "info": "Uses theme color variables by default"
  },
  {
    "type": "color",
    "id": "popup_background_color",
    "label": "Background color (Legacy)",
    "default": "#FFF0DD",
    "info": "Uses theme color variables by default"
  }
]
}
{% endschema %}
