{% comment %}
  DinVeda Product Hero - Custom hero section replacing main-product
  Two-column layout: left gallery, right buy box with trust bullets
  Proper Shopify product form with variants support
{% endcomment %}

{%- comment -%} Check if v2 template (via suffix or query param) {%- endcomment -%}
{% render 'dinveda-is-v2' %}

{%- liquid
  if product
    assign current_variant = product.selected_or_first_available_variant
  else
    assign current_variant = null
  endif
  
  assign product_form_id = 'product-form-' | append: section.id
  
  if product and product.template_suffix == 'pre-order'
    assign call_to_action = 'products.product.pre_order' | t
  elsif product
    assign call_to_action = 'products.product.add_to_cart' | t
  else
    assign call_to_action = 'Add to cart'
  endif

  if current_variant and current_variant.available == false
    assign call_to_action = 'products.product.sold_out' | t
  endif

  assign button_text = call_to_action
  
  # Metafield mappings with fallbacks
  assign phase_label = product.metafields.dinveda.ritual_timing | default: product.metafields.dinveda.tageszeit | default: section.settings.category_text
  assign tier_quote = product.metafields.dinveda.tier_quote | default: product.metafields.dinveda.animal_quote
  assign tier_name = product.metafields.dinveda.tier_name | default: product.metafields.dinveda.animal_name
  assign quote_text = tier_quote | default: section.settings.quote_text
  assign quote_attribution = tier_name | default: section.settings.quote_attribution
  
  # Intro paragraph: first paragraph of product.description or ritual_usage metafield
  assign intro_text = product.metafields.dinveda.ritual_usage
  if intro_text == blank and product.description != blank
    assign desc_paragraphs = product.description | split: '<p>'
    if desc_paragraphs.size > 1
      assign first_para = desc_paragraphs[1] | split: '</p>' | first
      assign intro_text = first_para | strip
    else
      assign intro_text = product.description | strip_html | truncate: 200
    endif
  endif
  
  # Ritual auf einen Blick metafields (v2)
  assign preparation_mode = product.metafields.dinveda.preparation_mode | default: "Warm"
  assign ritual_duration = product.metafields.dinveda.ritual_duration | default: "1–2 Min"
  
  # Traditional benefits bullets (from DV metafields)
  assign traditional_benefits = product.metafields.custom.dv_traditional_benefits
  assign has_traditional_benefits = false
  if traditional_benefits != blank
    assign has_traditional_benefits = true
    assign benefits_lines = traditional_benefits | newline_to_br | split: '<br />'
  endif
  
  # EU Bio Logo
  assign eu_bio_logo = product.metafields.custom.dv_eu_bio_logo
  if eu_bio_logo == blank and section.settings.eu_bio_logo != blank
    assign eu_bio_logo = section.settings.eu_bio_logo
  endif
  
  # Control code and origin
  assign control_code = product.metafields.custom.dv_control_code | default: section.settings.control_code
  assign origin = product.metafields.custom.dv_origin | default: section.settings.origin
-%}

{%- comment -%} Product JSON for Product object initialization {%- endcomment -%}
{% if product %}
  {% render 'product-json', product: product %}
{% endif %}

{%- comment -%} Product form config {%- endcomment -%}
{%- liquid
  assign product_variants_setting = settings.product_variants | default: 'dropdowns'
-%}
{% capture product_form_config %}
{
  "money_format": {{ shop.money_format | json }},
  "enable_history": true,
  "sold_out": {{ "products.product.sold_out" | t | json }},
  "button": {{ button_text | json }},
  "unavailable": {{ 'products.product.unavailable' | t | json }},
  "quickview": false,
  "featured_product": false,
  "swatches": {{ product_variants_setting | json }}
}
{% endcapture %}

{% style %}
  #dinveda-product-hero-{{ section.id }} {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }
{% endstyle %}

<section
  id="dinveda-product-hero-{{ section.id }}"
  class="dinveda-product-hero"
  data-section-id="{{ section.id }}"
  data-section-type="dinveda-product-hero"
  {% if product %}data-product-id="{{ product.id }}"{% endif %}
  data-asset-url="{{ 'section-product.js' | asset_url }}"
>
  <div class="dinveda-product-hero__container">
    
    {%- comment -%} Breadcrumbs (optional) {%- endcomment -%}
    {% if section.settings.show_breadcrumbs %}
      <nav class="dinveda-product-hero__breadcrumbs" aria-label="Breadcrumb">
        <a href="{{ routes.collections_url }}">Shop</a>
        {% if product.collections.size > 0 %}
          {% assign primary_collection = product.collections.first %}
          <span class="dinveda-product-hero__breadcrumb-separator">/</span>
          <a href="{{ primary_collection.url }}">{{ primary_collection.title }}</a>
        {% endif %}
        <span class="dinveda-product-hero__breadcrumb-separator">/</span>
        {% if product %}<span class="dinveda-product-hero__breadcrumb-current">{{ product.title }}</span>{% else %}<span>Product</span>{% endif %}
      </nav>
    {% endif %}

    <div class="dinveda-product-hero__grid">
      
      {%- comment -%} Left Column: Product Gallery {%- endcomment -%}
      <div class="dinveda-product-hero__gallery">
        {% if product and product.media.size > 0 %}
          {%- assign featured_media = product.selected_or_first_available_variant.featured_media | default: product.featured_media -%}
          
          {%- comment -%} Main Image {%- endcomment -%}
          <div class="dinveda-product-hero__main-image">
            {% if featured_media %}
              <img
                src="{{ featured_media | image_url: width: 800 }}"
                alt="{{ featured_media.alt | escape }}"
                class="dinveda-product-hero__image"
                data-media-id="{{ featured_media.id }}"
                loading="eager"
                width="{{ featured_media.width }}"
                height="{{ featured_media.height }}"
              >
              {%- comment -%} Image Labels {%- endcomment -%}
              <div class="dinveda-product-hero__image-labels">
                {% if section.settings.show_organic_label %}
                  <span class="dinveda-product-hero__image-label dinveda-product-hero__image-label--organic">ORGANIC</span>
                {% endif %}
                {% if section.settings.show_vegan_label %}
                  <span class="dinveda-product-hero__image-label dinveda-product-hero__image-label--vegan">VEGAN</span>
                {% endif %}
              </div>
            {% endif %}
          </div>

          {%- comment -%} Thumbnails {%- endcomment -%}
          {% if product.media.size > 1 %}
            <div class="dinveda-product-hero__thumbnails">
              {% for media in product.media limit: 4 %}
                <button
                  type="button"
                  class="dinveda-product-hero__thumbnail {% if forloop.first %}dinveda-product-hero__thumbnail--active{% endif %}"
                  data-media-id="{{ media.id }}"
                  aria-label="View image {{ forloop.index }}"
                >
                  <img
                    src="{{ media | image_url: width: 150 }}"
                    alt="{{ media.alt | escape }}"
                    class="dinveda-product-hero__thumbnail-img"
                    loading="lazy"
                    width="150"
                    height="150"
                  >
                </button>
              {% endfor %}
            </div>
          {% endif %}
        {% else %}
          <div class="dinveda-product-hero__main-image">
            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        {% endif %}
      </div>

      {%- comment -%} Right Column: Buy Box {%- endcomment -%}
      <div class="dinveda-product-hero__buy-box">
        
        {%- comment -%} Phase Label (from metafields) {%- endcomment -%}
        {% if phase_label != blank %}
          <p class="dinveda-product-hero__timing-label">{{ phase_label | escape }}</p>
        {% endif %}

        {%- comment -%} Product Title {%- endcomment -%}
        {% if product %}
          <h1 class="dinveda-product-hero__title">{{ product.title }}</h1>
        {% else %}
          <h1 class="dinveda-product-hero__title">Product Title</h1>
        {% endif %}

        {%- comment -%} EU Bio Logo {%- endcomment -%}
        {% if section.settings.show_eu_bio_logo and eu_bio_logo != blank %}
          <div class="dinveda-product-hero__eu-bio-logo-wrapper">
            {% if eu_bio_logo %}
              {%- liquid
                assign logo_height = section.settings.eu_bio_logo_size | default: 50
                assign logo_width = logo_height | times: 1.5 | round
              -%}
              <img
                src="{{ eu_bio_logo | image_url: width: 120 }}"
                alt="EU Bio Logo"
                class="dinveda-product-hero__eu-bio-logo"
                style="height: {{ logo_height }}px; width: {{ logo_width }}px; max-height: {{ logo_height }}px; max-width: {{ logo_width }}px;"
                width="{{ logo_width }}"
                height="{{ logo_height }}"
                loading="lazy"
              >
            {% endif %}
            {% if control_code != blank or origin != blank %}
              <div class="dinveda-product-hero__eu-bio-info">
                {% if control_code != blank %}
                  <div class="dinveda-product-hero__control-code">{{ control_code | escape }}</div>
                {% endif %}
                {% if origin != blank %}
                  <div class="dinveda-product-hero__origin">{{ origin | escape }}</div>
                {% endif %}
              </div>
            {% endif %}
          </div>
        {% endif %}

        {%- comment -%} Quote Card (from metafields, toggleable) {%- endcomment -%}
        {% if section.settings.show_quote_card and quote_text != blank %}
          <div class="dinveda-product-hero__quote-card">
            <blockquote class="dinveda-product-hero__quote-text">{{ quote_text | escape }}</blockquote>
            {% if quote_attribution != blank %}
              <p class="dinveda-product-hero__quote-attribution">— sagt der {{ quote_attribution | escape }}</p>
            {% endif %}
          </div>
        {% endif %}

        {%- comment -%} Intro Paragraph (from metafields, toggleable) {%- endcomment -%}
        {% if section.settings.show_intro and intro_text != blank %}
          <div class="dinveda-product-hero__intro">
            <p>{{ intro_text | escape }}</p>
          </div>
        {% endif %}

        {%- comment -%} Bullet Highlights (from traditional_benefits) {%- endcomment -%}
        {% if section.settings.show_bullet_highlights and has_traditional_benefits %}
          <div class="dinveda-product-hero__bullet-highlights">
            <ul class="dinveda-product-hero__bullet-list">
              {% assign items_rendered = 0 %}
              {% for line in benefits_lines %}
                {% assign trimmed_line = line | strip %}
                {% if trimmed_line != blank and items_rendered < 6 %}
                  {% assign clean_line = trimmed_line | replace: '• ', '' | replace: '•', '' | replace: '- ', '' | strip %}
                  {% if clean_line != blank %}
                    <li class="dinveda-product-hero__bullet-item">{{ clean_line | escape }}</li>
                    {% assign items_rendered = items_rendered | plus: 1 %}
                  {% endif %}
                {% endif %}
              {% endfor %}
            </ul>
          </div>
        {% endif %}

        {%- comment -%} Price {%- endcomment -%}
        {% if product and current_variant %}
          <div class="dinveda-product-hero__price-section">
            <div class="dinveda-product-hero__price-wrapper">
              <div class="dinveda-product-hero__price" data-product-price>
                <span data-regular-price>{{ current_variant.price | money }}</span>
                {% if current_variant.compare_at_price > current_variant.price %}
                  <span class="dinveda-product-hero__compare-price" data-compare-price>
                    {{ current_variant.compare_at_price | money }}
                  </span>
                {% endif %}
              </div>
              <span class="dinveda-product-hero__price-note">{{ section.settings.price_note | default: "inkl. MwSt. / 100g Dose" | escape }}</span>
            </div>
          </div>

          {%- comment -%} Product Form {%- endcomment -%}
          {% form 'product', product,
            id: product_form_id,
            class: "dinveda-product-hero__form js-prod-form-submit"
          %}
            
            <input type="hidden" name="id" id="formVariantId" value="{{ current_variant.id }}">

            {%- comment -%} Variants {%- endcomment -%}
            {% unless product.has_only_default_variant %}
            <div class="dinveda-product-hero__variants" data-section="{{ section.id }}">
              {% for option in product.options_with_values %}
                <div class="dinveda-product-hero__variant-option">
                  <label class="dinveda-product-hero__variant-label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
                    {{ option.name }}
                  </label>
                  <div class="dinveda-product-hero__variant-select">
                    <select
                      id="Option-{{ section.id }}-{{ forloop.index0 }}"
                      class="js-variant-selector"
                      name="options[{{ option.name | escape }}]"
                    >
                      {% for value in option.values %}
                        <option
                          value="{{ value | escape }}"
                          {% if option.selected_value == value %}selected="selected"{% endif %}
                        >
                          {{ value }}
                        </option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endunless %}

            {%- comment -%} Add to Cart Button {%- endcomment -%}
            <button
              type="submit"
              name="add"
              class="dinveda-product-hero__add-to-cart"
              {% unless current_variant.available %}disabled{% endunless %}
              data-add-to-cart-text
            >
              {{ section.settings.add_to_cart_label | default: "IN DEN WARENKORB" | escape }}
            </button>

            {%- comment -%} Buy Now Button (if enabled) {%- endcomment -%}
            {% if section.settings.enable_buy_now and current_variant.available %}
              <button
                type="button"
                class="dinveda-product-hero__buy-now {% if section.settings.buy_now_primary %}dinveda-product-hero__buy-now--primary{% endif %}"
                data-buy-now
                data-variant-id="{{ current_variant.id }}"
              >
                {{ section.settings.buy_now_label | default: "Jetzt kaufen" | escape }}
              </button>
            {% endif %}

            {%- comment -%} Payment Options Link {%- endcomment -%}
            {% if section.settings.show_payment_options_link %}
              <a href="#payment-options" class="dinveda-product-hero__payment-link">
                {{ section.settings.payment_options_link_text | default: "WEITERE BEZAHLMÖGLICHKEITEN" | escape }}
              </a>
            {% endif %}


            {%- comment -%} Shipping Info {%- endcomment -%}
            {% if section.settings.shipping_text != blank %}
              <div class="dinveda-product-hero__shipping">
                <span class="material-symbols-outlined dinveda-product-hero__shipping-icon">local_shipping</span>
                <span class="dinveda-product-hero__shipping-text">{{ section.settings.shipping_text | escape }}</span>
              </div>
            {% endif %}

            {%- comment -%} Trust Badges (as blocks, toggleable) {%- endcomment -%}
            {% if section.settings.show_badges and section.blocks.size > 0 %}
              <div class="dinveda-product-hero__trust-bullets">
                {% for block in section.blocks %}
                  {% if block.type == 'trust_badge' %}
                    <div class="dinveda-product-hero__trust-item" {{ block.shopify_attributes }}>
                      {% if block.settings.icon_material != blank %}
                        <span class="material-symbols-outlined dinveda-product-hero__trust-icon">{{ block.settings.icon_material }}</span>
                      {% elsif block.settings.icon != blank %}
                        <div class="dinveda-product-hero__trust-icon">
                          {{ block.settings.icon | image_url: width: 20 | image_tag: alt: block.settings.text, loading: 'lazy' }}
                        </div>
                      {% elsif block.settings.icon_svg != blank %}
                        <div class="dinveda-product-hero__trust-icon">
                          {{ block.settings.icon_svg }}
                        </div>
                      {% endif %}
                      {% if block.settings.text != blank %}
                        <span class="dinveda-product-hero__trust-text">{{ block.settings.text | escape }}</span>
                      {% endif %}
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}

          {% endform %}
        {% endif %}

        {%- comment -%} Ritual auf einen Blick {%- endcomment -%}
        {% if section.settings.show_ritual_glance_row %}
          <div class="dinveda-product-hero__ritual-glance">
            <div class="dinveda-product-hero__ritual-glance-item">
              <span class="dinveda-product-hero__ritual-glance-label">Tageszeit</span>
              <span class="dinveda-product-hero__ritual-glance-value">{{ phase_label | escape }}</span>
            </div>
            <div class="dinveda-product-hero__ritual-glance-item">
              <span class="dinveda-product-hero__ritual-glance-label">Zubereitung</span>
              <span class="dinveda-product-hero__ritual-glance-value">{{ preparation_mode | escape }}</span>
            </div>
            <div class="dinveda-product-hero__ritual-glance-item">
              <span class="dinveda-product-hero__ritual-glance-label">Dauer</span>
              <span class="dinveda-product-hero__ritual-glance-value">{{ ritual_duration | escape }}</span>
            </div>
          </div>
        {% endif %}

        {%- comment -%} Social Share (if enabled) {%- endcomment -%}
        {% if section.settings.show_social_share %}
          <div class="dinveda-product-hero__social-share">
            <span class="dinveda-product-hero__social-label">TEILEN</span>
            <div class="dinveda-product-hero__social-icons">
              <a href="https://www.facebook.com/sharer/sharer.php?u={{ shop.url | append: product.url | url_param_escape }}" target="_blank" rel="noopener" class="dinveda-product-hero__social-icon" aria-label="Share on Facebook">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
                </svg>
              </a>
              <a href="https://twitter.com/intent/tweet?url={{ shop.url | append: product.url | url_param_escape }}&text={{ product.title | url_param_escape }}" target="_blank" rel="noopener" class="dinveda-product-hero__social-icon" aria-label="Share on Twitter">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
                </svg>
              </a>
              <a href="https://pinterest.com/pin/create/button/?url={{ shop.url | append: product.url | url_param_escape }}&media={{ product.featured_image | image_url: width: 1200 | url_param_escape }}&description={{ product.title | url_param_escape }}" target="_blank" rel="noopener" class="dinveda-product-hero__social-icon" aria-label="Share on Pinterest">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12c0 4.84 3.44 8.87 8 9.8-.11-.98-.2-2.48.04-3.54.22-.94 1.43-6.35 1.43-6.35s-.36-.72-.36-1.78c0-1.66.96-2.9 2.16-2.9 1.02 0 1.51.77 1.51 1.69 0 1.02-.65 2.55-.99 3.97-.28 1.2.6 2.18 1.78 2.18 2.14 0 3.78-2.26 3.78-5.52 0-2.88-2.07-4.9-5.03-4.9-3.43 0-5.44 2.57-5.44 5.23 0 1.02.39 2.12.88 2.72a.36.36 0 0 1 .08.4l-.33 1.33c-.05.2-.16.24-.37.15-1.38-.64-2.24-2.65-2.24-4.26 0-3.48 2.53-6.68 7.3-6.68 3.83 0 6.8 2.73 6.8 6.38 0 3.8-2.4 6.86-5.86 6.86-1.15 0-2.23-.6-2.6-1.3l-.71 2.7c-.26 1-.96 2.25-1.43 3.01 1.08.33 2.22.51 3.4.51 5.52 0 10-4.48 10-10S17.52 2 12 2z"/>
                </svg>
              </a>
            </div>
          </div>
        {% endif %}

      </div>
    </div>
  </div>
</section>

{%- comment -%} Load product form JS {%- endcomment -%}
<script src="{{ 'product.js' | asset_url }}" defer></script>

<script>
  (function() {
    'use strict';
    
    function initHeroSection() {
      const section = document.querySelector('#dinveda-product-hero-{{ section.id }}');
      if (!section) return;

      // Gallery thumbnail switching
      const thumbs = section.querySelectorAll('.dinveda-product-hero__thumbnail');
      const mainImage = section.querySelector('.dinveda-product-hero__image');
      
      if (thumbs.length > 0 && mainImage) {
        thumbs.forEach(function(thumb) {
          thumb.addEventListener('click', function() {
            const mediaId = this.getAttribute('data-media-id');
            const thumbImg = this.querySelector('.dinveda-product-hero__thumbnail-img');
            
            if (thumbImg && mediaId) {
              const newSrc = thumbImg.src.replace(/width=\d+/, 'width=800').replace(/_\d+x\d+/, '');
              mainImage.src = newSrc;
              mainImage.setAttribute('data-media-id', mediaId);
              
              thumbs.forEach(function(t) {
                t.classList.remove('dinveda-product-hero__thumbnail--active');
              });
              this.classList.add('dinveda-product-hero__thumbnail--active');
            }
          });
        });
      }

      // Quantity controls
      const qtyField = section.querySelector('.dinveda-product-hero__quantity-field');
      const qtyDecrease = section.querySelector('[data-quantity-decrease]');
      const qtyIncrease = section.querySelector('[data-quantity-increase]');
      
      if (qtyField && qtyDecrease && qtyIncrease) {
        qtyDecrease.addEventListener('click', function() {
          const current = parseInt(qtyField.value) || 1;
          if (current > 1) {
            qtyField.value = current - 1;
          }
        });
        
        qtyIncrease.addEventListener('click', function() {
          const current = parseInt(qtyField.value) || 1;
          qtyField.value = current + 1;
        });
      }

      // Set product form config
      const form = section.querySelector('.js-prod-form-submit');
      if (form) {
        const productFormConfig = {{ product_form_config }};
        form.setAttribute('data-product-form', productFormConfig);
      }

      // Buy Now button functionality
      const buyNowBtn = section.querySelector('[data-buy-now]');
      const variantSelect = section.querySelector('#formVariantId');
      
      function updateBuyNowVariant() {
        if (buyNowBtn && variantSelect) {
          const currentVariantId = variantSelect.value;
          buyNowBtn.setAttribute('data-variant-id', currentVariantId);
        }
      }
      
      if (buyNowBtn) {
        // Update variant ID when variant changes
        const variantSelectors = section.querySelectorAll('.js-variant-selector');
        variantSelectors.forEach(function(selector) {
          selector.addEventListener('change', updateBuyNowVariant);
        });
        
        // Initial variant ID update
        updateBuyNowVariant();
        
        buyNowBtn.addEventListener('click', function() {
          const variantId = this.getAttribute('data-variant-id') || (variantSelect ? variantSelect.value : null);
          const quantity = 1;
          
          if (!variantId) {
            console.error('Variant ID not found');
            return;
          }

          // Add to cart via AJAX
          fetch('/cart/add.js', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              id: variantId,
              quantity: quantity
            })
          })
          .then(response => response.json())
          .then(data => {
            // Redirect to checkout
            window.location.href = '/checkout';
          })
          .catch(error => {
            console.error('Error adding to cart:', error);
          });
        });
      }

      // Initialize Product object from JSON (Slice theme pattern)
      const productJson = section.querySelector('.product-json');
      if (productJson) {
        try {
          var Product = JSON.parse(productJson.innerHTML || '{}');
          var Events = typeof EventEmitter3 !== 'undefined' ? new EventEmitter3() : { trigger: function() {}, on: function() {} };
          if (Events.emit) {
            Events.trigger = Events.emit;
          }
          
          // Initialize product form
          if (typeof ProductForm !== 'undefined' && form) {
            new ProductForm(section, '{{ section.id }}', Events, Product);
          }
        } catch (e) {
          console.error('Error initializing product form:', e);
        }
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initHeroSection);
    } else {
      initHeroSection();
    }
  })();
</script>

{%- comment -%} Schema must be at the top level, outside all HTML tags {%- endcomment -%}
{% schema %}
{
  "name": "DinVeda Product Hero",
  "tag": "section",
  "class": "dynamic-section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_breadcrumbs",
      "label": "Breadcrumbs anzeigen",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_thumbnails",
      "label": "Thumbnails anzeigen",
      "default": false
    },
    {
      "type": "text",
      "id": "category_text",
      "label": "Phase Label (Fallback)",
      "info": "Used if product.metafields.dinveda.ritual_timing or tageszeit is empty"
    },
    {
      "type": "header",
      "content": "Quote Card"
    },
    {
      "type": "checkbox",
      "id": "show_quote_card",
      "label": "Show quote card",
      "default": true
    },
    {
      "type": "text",
      "id": "quote_text",
      "label": "Quote Text (Fallback)",
      "info": "Used if product.metafields.dinveda.tier_quote or animal_quote is empty"
    },
    {
      "type": "text",
      "id": "quote_attribution",
      "label": "Quote Attribution (Fallback)",
      "info": "Used if product.metafields.dinveda.tier_name or animal_name is empty"
    },
    {
      "type": "header",
      "content": "Intro"
    },
    {
      "type": "checkbox",
      "id": "show_intro",
      "label": "Show intro paragraph",
      "default": true,
      "info": "Uses product.metafields.dinveda.ritual_usage or first paragraph of product.description"
    },
    {
      "type": "checkbox",
      "id": "show_bullet_highlights",
      "label": "Show bullet highlights",
      "default": true,
      "info": "Displays bullet list from product.metafields.custom.dv_traditional_benefits (one bullet per line)"
    },
    {
      "type": "header",
      "content": "EU Bio Logo"
    },
    {
      "type": "checkbox",
      "id": "show_eu_bio_logo",
      "label": "Show EU Bio Logo",
      "default": true,
      "info": "Display EU Bio logo with control code and origin. Product metafield custom.dv_eu_bio_logo takes priority if present."
    },
    {
      "type": "image_picker",
      "id": "eu_bio_logo",
      "label": "EU Bio Logo",
      "info": "EU Bio logo image. Product metafield custom.dv_eu_bio_logo takes priority if present. Must comply with EU-Bio-Verordnung 848/2018 (minimum 9mm height, 1:1.5 aspect ratio)."
    },
    {
      "type": "range",
      "id": "eu_bio_logo_size",
      "label": "EU Bio Logo Size (height)",
      "min": 34,
      "max": 80,
      "step": 1,
      "unit": "px",
      "default": 50,
      "info": "EU Regulation: Minimum 9mm height (34px) required. Logo must maintain 1:1.5 aspect ratio."
    },
    {
      "type": "text",
      "id": "control_code",
      "label": "Control Body Code",
      "default": "DE-ÖKO-037",
      "info": "Control body code number (e.g., DE-ÖKO-037). Product metafield custom.dv_control_code takes priority if present."
    },
    {
      "type": "text",
      "id": "origin",
      "label": "Place of Origin",
      "default": "EU-Landwirtschaft",
      "info": "Place of origin of agricultural raw materials (e.g., EU-Landwirtschaft, Nicht-EU-Landwirtschaft). Product metafield custom.dv_origin takes priority if present."
    },
    {
      "type": "header",
      "content": "Preis"
    },
    {
      "type": "text",
      "id": "price_note",
      "label": "Preis Hinweis",
      "info": "Optional price note displayed below price"
    },
    {
      "type": "header",
      "content": "Buttons"
    },
    {
      "type": "text",
      "id": "add_to_cart_label",
      "label": "In den Warenkorb Text",
      "info": "Leave blank to use default translation"
    },
    {
      "type": "text",
      "id": "shipping_text",
      "label": "Shipping info text",
      "info": "Displayed below add to cart button. Leave blank to hide."
    },
    {
      "type": "checkbox",
      "id": "enable_buy_now",
      "label": "Jetzt kaufen Button aktivieren",
      "default": true
    },
    {
      "type": "text",
      "id": "buy_now_label",
      "label": "Jetzt kaufen Text",
      "info": "Leave blank to use default translation"
    },
    {
      "type": "checkbox",
      "id": "buy_now_primary",
      "label": "Jetzt kaufen als Hauptbutton",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_payment_options_link",
      "label": "Weitere Bezahlmöglichkeiten Link anzeigen",
      "default": false
    },
    {
      "type": "text",
      "id": "payment_options_link_text",
      "label": "Bezahlmöglichkeiten Link Text",
      "default": "WEITERE BEZAHLMÖGLICHKEITEN"
    },
    {
      "type": "header",
      "content": "Trust Badges"
    },
    {
      "type": "checkbox",
      "id": "show_badges",
      "label": "Show trust badges",
      "default": true
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 120,
      "step": 8,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 120,
      "step": 8,
      "unit": "px",
      "default": 24
    },
    {
      "type": "header",
      "content": "Bild Labels"
    },
    {
      "type": "checkbox",
      "id": "show_organic_label",
      "label": "ORGANIC Label anzeigen",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vegan_label",
      "label": "VEGAN Label anzeigen",
      "default": true
    },
    {
      "type": "header",
      "content": "Social Sharing"
    },
    {
      "type": "checkbox",
      "id": "show_social_share",
      "label": "Social Sharing anzeigen",
      "default": true
    },
    {
      "type": "header",
      "content": "Ritual auf einen Blick (v2)"
    },
    {
      "type": "checkbox",
      "id": "show_ritual_glance_row",
      "label": "Show 'Ritual auf einen Blick' row",
      "default": true,
      "info": "Displays Tageszeit, Zubereitung, and Dauer in a micro-row"
    }
  ],
  "blocks": [
    {
      "type": "trust_badge",
      "name": "Trust Badge",
      "limit": 3,
      "settings": [
        {
          "type": "image_picker",
          "id": "icon",
          "label": "Icon (Image)",
          "info": "Optional: Upload an icon image"
        },
        {
          "type": "html",
          "id": "icon_svg",
          "label": "Icon (SVG)",
          "info": "Optional: Paste SVG code for icon"
        },
        {
          "type": "text",
          "id": "icon_material",
          "label": "Material Symbol icon name",
          "info": "Optional: Material Symbols icon name (e.g., 'eco', 'factory', 'local_shipping')",
          "default": "eco"
        },
        {
          "type": "text",
          "id": "text",
          "label": "Badge Text",
          "info": "Trust badge text to display"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "DinVeda Product Hero"
    }
  ]
}
{% endschema %}
